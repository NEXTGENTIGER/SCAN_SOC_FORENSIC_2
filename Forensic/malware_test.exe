import os

# === 1. Création des dossiers ===
base_dir = "/home/user/RR"
input_dir = os.path.join(base_dir, "input")
rules_dir = os.path.join(base_dir, "rules")

os.makedirs(input_dir, exist_ok=True)
os.makedirs(rules_dir, exist_ok=True)

# === 2. Création du fichier "malware" simulé ===
malware_path = os.path.join(input_dir, "malware_test.exe")

malware_content = """MZ
PE
.exe
NOP sled: \x90\x90\x90\x90\x90\x90\x90\x90
\x68\x12\x34\x56\x78\xC3
\xE8\x00\x00\x00\x00
\xFF\xD0
cmd.exe
powershell
wget
curl
download
http://malicious.com
https://evil.com
ftp://bad.com
192.168.1.1
10.0.0.2
svchost.exe
explorer.exe
system32
rundll32.exe
regsvr32.exe
HKEY_LOCAL_MACHINE
HKEY_CURRENT_USER
RunOnce
RunServices
Startup
smtp://mail
irc://ircserver
copy
move
delete
rename
create
net user
net group
net localgroup
net share
net session
AES
RSA
encrypt
decrypt
crypt
virtualbox
vmware
wireshark
debugger
sandbox
startup
autostart
scheduled
task
service
admin
administrator
system
root
sudo
upload
send
receive
transfer
exec
execute
run
launch
start
tcp
udp
icmp
dns
http
.dll
.bat
.vbs
.ps1
modify
change
alter
update
replace
inject
injection
hook
hooking
patch
connect
connection
socket
port
listen
systeminfo
whoami
ipconfig
netstat
tasklist
"""

with open(malware_path, "w", encoding="utf-8") as f:
    f.write(malware_content)

print(f"✅ Fichier simulé créé : {malware_path}")

# === 3. Règle YARA personnalisée associée ===
yara_rule = """
rule SimulatedMalware {
    meta:
        description = "Détection du malware simulé"
        author = "ChatGPT"
        date = "2025-06-14"

    strings:
        $mz = "MZ"
        $pe = "PE"
        $exe = ".exe"
        $nop = { 90 90 90 90 90 90 90 90 }
        $call = { E8 ?? ?? ?? ?? }
        $cmd = "cmd.exe"
        $ip = /192\\.168\\.1\\.1/
        $net = "ftp://"
    condition:
        3 of them
}
"""

yara_path = os.path.join(rules_dir, "simulated_malware.yar")
with open(yara_path, "w", encoding="utf-8") as r:
    r.write(yara_rule)

print(f"✅ Règle YARA créée : {yara_path}")
